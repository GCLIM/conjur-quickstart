name: Conjur Production Deployment

on:
    push:
        branches:
        - production 

jobs:
    deployment:
        runs-on: conjur01
        environment: production

    steps:
        - name: Setup SSH
          uses: webfactory/ssh-agent@v0.5.3
          with:
            ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }} 

        - name: Deploy to Remote Server
          run: |
            ssh ${{ secrets.USER }}@${{ TARGET_HOST_1 }} "git pull origin master && cd conjur-quickstarts && ./test_workflow.sh"
